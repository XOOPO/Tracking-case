<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tracking Case Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&display=swap" rel="stylesheet">


    <style>
        /* ===== NEON FUTURISTIC TITLE ===== */
.neon-title{
  font-family: 'Orbitron', sans-serif;
  font-size: 32px;
  font-weight: bold;
  color: #e8ffff;
  text-shadow:
    0 0 5px #0ff,
    0 0 15px #0ff,
    0 0 30px #0cf,
    0 0 60px rgba(0,200,255,0.8),
    0 0 100px rgba(0,200,255,1);
}
.neon-title{
  padding: 10px 18px;
  border-radius: 10px;
  background: rgba(0,10,20,0.6);
  box-shadow:
    0 0 10px #00e1ff,
    inset 0 0 15px rgba(0,200,255,0.4);
}

/* Efek denyut neon */
@keyframes neonPulse {
  from {
    text-shadow:
      0 0 5px #00f6ff,
      0 0 10px #00e1ff,
      0 0 25px #00c8ff,
      0 0 50px rgba(0,200,255,0.7);
  }
  to {
    text-shadow:
      0 0 10px #a8ffff,
      0 0 20px #00f6ff,
      0 0 35px #00e1ff,
      0 0 80px rgba(0,230,255,1);
  }
}

/* MODE SIANG ‚Äì neon tetap terlihat */
body.day-mode .neon-title{
  color: #00bfff;
  text-shadow:
    0 0 6px #00c8ff,
    0 0 12px #00aaff,
    0 0 24px rgba(0,140,255,0.8);
}

/* MODE MALAM ‚Äì lebih glow */
body.night-mode .neon-title{
  color: #aaffff;
}

    /* ===== NEW MODERN SIDEBAR ===== */
    .sidebar {
        width: 250px;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        background: #0d0f15;
        padding: 20px 18px;
        border-right: 1px solid #1f1f1f;
        color: #ccc;
        z-index: 1000;
    }

    .sidebar h3 {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 35px;
        color: #fff;
    }

    .sidebar a {
        display: flex;
        align-items: center;
        gap: 14px;
        font-size: 19px;          /* ‚¨ÖÔ∏è HURUF LEBIH BESAR */
        font-weight: 600;         /* ‚¨ÖÔ∏è LEBIH TEBAL */
        padding: 12px 16px;       /* ‚¨ÖÔ∏è LEBIH LEBAR & RAPI */
        margin-bottom: 10px;
        border-radius: 12px;
        text-decoration: none;
        color: #f5f5f5;
        transition: 0.25s;
    }

    .sidebar a:hover {
        background: #1b1d24;
    }

    .sidebar a.active-link {
        background: #3b82f6;
        color: #fff;
    }

    .sidebar a i {
        font-size: 20px;
    }

    /* BACKGROUND */
    body {
        background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        font-family: Arial, sans-serif;
        color: #e0e0e0;
        overflow-x: hidden;
    }

    /* MAIN CONTENT */
    .main-container {
        margin-left: 250px;
        padding: 80px 30px 40px 30px;
        max-width: 2400px;
    }

    /* RUNNING TEXT */
    .running-text-wrapper {
        position: fixed;
        top: 0;
        left: 250px;
        right: 0;
        height: 40px;
        background: rgba(0,0,0,0.6);
        display: flex;
        align-items: center;
        padding-left: 15px;
        color: #CCFF00;
        z-index: 2000;
        overflow: hidden;
    }

    .running-text {
        white-space: nowrap;
        padding-left: 100%;
        animation: runtext 16s linear infinite;
        font-weight: bold;
        font-size: 18px;
    }

    @keyframes runtext {
        0% { transform: translateX(0); }
        100% { transform: translateX(-100%); }
    }

    /* CARD */
    .card {
        background: rgba(20,20,30,0.9);
        border-radius: 15px;
        box-shadow: 0 0 25px rgba(0,255,255,0.4);
        border: 1px solid rgba(0,255,255,0.3);
        padding: 20px;
    }

    /* TABLE */
    .table-wrapper-fix {
        width: 100%;
        overflow-x: visible !important;
    }

    table.table {
        width: 100% !important;
        table-layout: fixed !important;
        border-collapse: collapse;
    }

    .table th,
    .table td {
        text-align: center !important;
        vertical-align: middle !important;
        padding: 10px 12px;
        white-space: normal !important;
        word-break: break-word;
    }

    .table thead th {
        background: rgba(0,255,255,0.15);
        color: #00ffff;
        border-bottom: 1px solid #00ffff;
        font-weight: bold;
    }

    th:nth-child(1), td:nth-child(1) { width: 5%; }
    th:nth-child(2), td:nth-child(2) { width: 8%; }
    th:nth-child(3), td:nth-child(3) { width: 5%; }
    th:nth-child(4), td:nth-child(4) { width: 5%; }
    th:nth-child(5), td:nth-child(5) { width: 18%; }
    th:nth-child(6), td:nth-child(6) { width: 6%; }
    th:nth-child(7), td:nth-child(7) { width: 6%; }
    th:nth-child(8), td:nth-child(8) { width: 20%; }
    th:nth-child(9), td:nth-child(9) { width: 8%; }
    th:nth-child(10), td:nth-child(10) { width: 9%; }
    th:nth-child(11), td:nth-child(10) { width: 8%; }

    .highlight {
        background: yellow;
        color: black;
        font-weight: bold;
    }

    .pagination .active .page-link {
        background-color: #00ffff;
        color: #000;
        border-color: #00ffff;
    }

    /* ===== NEON LOGO ===== */
.logo-neon{
    color:#39ff14;
    text-shadow:
        0 0 5px #39ff14,
        0 0 10px #39ff14,
        0 0 20px #00ff99;
}

/* ===== LIGHT SWITCH ===== */
.mode-toggle{
    display:flex;
    gap:10px;
    margin-bottom:25px;
}

.mode-toggle button{
    flex:1;
    border:none;
    border-radius:6px;
    font-weight:700;
    padding:6px;
    cursor:pointer;
    background:#111;
    color:#39ff14;
    box-shadow:0 0 8px #39ff14;
    transition:.3s;
}

.mode-toggle button:hover{
    background:#39ff14;
    color:black;
}

/* ===== MANUAL MODE ===== */
body.day-mode{
    background: linear-gradient(135deg,#bddfff,#e6f7ff);
    color:#000;
}

body.night-mode{
    background: linear-gradient(135deg,#01010a,#090020);
}

/* ===== WEATHER FUTURISTIC ===== */
#infoBox{
    font-family: Orbitron, monospace;
    background: rgba(0,0,0,.65);
    border:1px solid #00ffff;
    box-shadow:0 0 20px cyan;
    border-radius: 14px;
    color:#00ffff;
}

/* ===== NEON PAGINATION ===== */
.pagination .page-link{
    background:#000;
    color:#00ffff;
    border:1px solid cyan;
    box-shadow:0 0 8px cyan;
}

.pagination .page-item.active .page-link{
    background:#39ff14;
    color:black;
    box-shadow:0 0 15px #39ff14;
    border-color:#39ff14;
}

        /* ===== DAY / NIGHT MODE ===== */
body.day-mode {
    background: linear-gradient(135deg,#87cefa,#e0f6ff);
    color:#111;
}

body.night-mode {
    background: linear-gradient(135deg,#050014,#120028);
}

#infoBox{
    background: rgba(0,0,0,0.5);
    padding: 12px 18px;
    border-radius: 12px;
    box-shadow: 0 0 15px cyan;
    color: #00ffff;
    font-size: 15px;
}

body.day-mode #infoBox{
    background: rgba(255,255,255,0.7);
    color:#000;
    box-shadow: 0 0 10px #333;
}


    </style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <h3>TRACKING CASE</h3>

<div class="mode-toggle">
    <button onclick="setDay()" id="dayBtn">‚òÄ DAY</button>
    <button onclick="setNight()" id="nightBtn">üåô NIGHT</button>
</div>

    <a href="/?sheet=Main" class="{% if selected_sheet == 'MAIN' %}active-link{% endif %}">
        <i class="bi bi-grid"></i> MAIN
    </a>

    <a href="/?sheet=AIA" class="{% if selected_sheet == 'AIA' %}active-link{% endif %}">
        <i class="bi bi-envelope"></i> AIA
    </a>

    <a href="/?sheet=OCR" class="{% if selected_sheet == 'OCR' %}active-link{% endif %}">
        <i class="bi bi-file-earmark-text"></i> OCR
    </a>

    <a href="/?sheet=MYR" class="{% if selected_sheet == 'MYR' %}active-link{% endif %}">
        <i class="bi bi-currency-dollar"></i> MYR
    </a>

    <a href="/?sheet=SGD" class="{% if selected_sheet == 'SGD' %}active-link{% endif %}">
        <i class="bi bi-cash-coin"></i> SGD
    </a>

    <a href="/?sheet=CRM" class="{% if selected_sheet == 'CRM' %}active-link{% endif %}">
        <i class="bi bi-person-lines-fill"></i> CRM
    </a>

    <a href="/?sheet=CTX" class="{% if selected_sheet == 'CTX' %}active-link{% endif %}">
        <i class="bi bi-diagram-3"></i> CTX
    </a>

    <a href="/?sheet=GRP" class="{% if selected_sheet == 'GRP' %}active-link{% endif %}">
        <i class="bi bi-people"></i> GRP
    </a>

    <a href="/?sheet=Suggestions" class="{% if selected_sheet == 'Suggestions' %}active-link{% endif %}">
        <i class="bi bi-lightbulb"></i> Suggestions
    </a>
</div>

<!-- RUNNING TEXT -->
<div class="running-text-wrapper">
    <div class="running-text">
        üîî Latest update: The dashboard data is automatically updated every day! üîî
    </div>
</div>

<!-- MAIN CONTENT -->
<div class="main-container">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="neon-title">üìä Tracking Case Dashboard</h1>

          <!-- WEATHER & CLOCK -->
    <div class="text-end" id="infoBox">
        <div id="clock" class="fw-bold"></div>
        <div id="date"></div>
        <div id="weather">Loading weather...</div>
    </div>

        <div>
            <a href="/add" class="btn btn-primary me-2">‚ûï Add Case</a>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#suggestionModal">üí° Add Suggestion</button>
        </div>
    </div>

    <div class="modal fade" id="suggestionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" style="background:#1b1d24; color:white;">
            <div class="modal-header">
                <h5 class="modal-title">Submit a Suggestion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form action="/add_suggestion" method="POST">
                <div class="modal-body">

                    <div class="mb-3">
                        <label>Your Name</label>
                        <input type="text" name="user_name" class="form-control">
                    </div>

                    <div class="mb-3">
                        <label>Department</label>
                        <input type="text" name="department" class="form-control">
                    </div>

                    <div class="mb-3">
                        <label>Product</label>
                        <input type="text" name="product" class="form-control">
                    </div>

                    <div class="mb-3">
                        <label>Your Suggestion</label>
                        <textarea name="suggestion" rows="4" class="form-control" required></textarea>
                    </div>

                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary">Submit</button>
                </div>
            </form>
        </div>
    </div>
</div>

    <!-- SEARCH -->
    <form method="GET" action="/" class="d-flex mb-3">
        <input type="hidden" name="sheet" value="{{ selected_sheet }}">
        <input type="text" name="search" placeholder="Search Case ID..." class="form-control w-25 me-2" value="{{ search_query }}">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>

    <!-- TABLE -->
    <div class="card">
        <div class="table-wrapper-fix">
            <table class="table table-bordered table-hover text-light">
                <thead>
                     <tr>
        {% for h in headers %}
<th>
    {% if h == '_sheet' %}
        Category
    {% else %}
        {{ h }}
    {% endif %}
</th>
{% endfor %}
    </tr>
                </thead>
                <tbody>
                   {% for row in records %}
    <tr>
        {% for h in headers %}
        <td>
            {% if h == "Telegram Link" and row[h] %}
                <a href="{{ row[h] }}" target="_blank" class="text-info fw-bold">Open</a>
            {% else %}
                {% if search_query %}
                    {{ row[h]|string|replace(search_query, '<span class="highlight">' + search_query + '</span>')|safe }}
                {% else %}
                    {{ row[h] }}
                {% endif %}
            {% endif %}
        </td>
        {% endfor %}
    </tr>
    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- PAGINATION -->
    <div class="d-flex justify-content-center mt-3">
        {% if total_pages > 1 %}
        <nav>
            <ul class="pagination">
                {% if page > 1 %}
                <li class="page-item"><a class="page-link" href="?sheet={{selected_sheet}}&page={{page-1}}&search={{search_query}}">Previous</a></li>
                {% endif %}

                {% for p in range(1, total_pages+1) %}
                <li class="page-item {% if p == page %}active{% endif %}">
                    <a class="page-link" href="?sheet={{selected_sheet}}&page={{p}}&search={{search_query}}">{{p}}</a>
                </li>
                {% endfor %}

                {% if page < total_pages %}
                <li class="page-item"><a class="page-link" href="?sheet={{selected_sheet}}&page={{page+1}}&search={{search_query}}">Next</a></li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>

</div>

<script>
const API_KEY = "8bb671874e300e361bf9b014ea2eef6b";
const CITY = "Phnom Penh";

async function loadWeather(){
  try {
    const res = await fetch(
      `https://api.openweathermap.org/data/2.5/weather?q=${CITY}&appid=${API_KEY}&units=metric`
    );

    const data = await res.json();

    if (data.cod !== 200) {
      throw new Error(data.message);
    }

    const temp = data.main.temp.toFixed(1);
    const desc = data.weather[0].description.toUpperCase();

    document.getElementById("weather").innerHTML =
      `üå§Ô∏è ${CITY} | ${temp}¬∞C | ${desc}`;

  } catch (err) {
    document.getElementById("weather").innerHTML = "‚ùå Weather unavailable";
    console.error("Weather Error:", err);
  }
}

// DATE + CLOCK
function updateClock(){
  const now = new Date();
  const time = now.toLocaleTimeString();
  const date = now.toLocaleDateString('en-GB',{
      weekday:'long',
      day:'numeric',
      month:'long',
      year:'numeric'
  });

  document.getElementById("clock").innerHTML = "‚è∞ " + time;
  document.getElementById("date").innerHTML = "üìÖ " + date;
}

// RUN
loadWeather();
setInterval(updateClock, 1000);
setInterval(loadWeather, 600000); // refresh tiap 10 menit
</script>


<script>
function setDay(){
    document.body.classList.add("day-mode");
    document.body.classList.remove("night-mode");
    localStorage.setItem("theme","day");
    updateButton();
}

function setNight(){
    document.body.classList.add("night-mode");
    document.body.classList.remove("day-mode");
    localStorage.setItem("theme","night");
    updateButton();
}

function updateButton(){
    const theme = localStorage.getItem("theme");
    const dayBtn = document.getElementById("dayBtn");
    const nightBtn = document.getElementById("nightBtn");

    if(theme === "day"){
        dayBtn.style.background = "#39ff14";
        dayBtn.style.color = "#000";
        nightBtn.style.background = "#111";
        nightBtn.style.color = "#39ff14";
    } else {
        nightBtn.style.background = "#39ff14";
        nightBtn.style.color = "#000";
        dayBtn.style.background = "#111";
        dayBtn.style.color = "#39ff14";
    }
}

// LOAD THEME ON START
document.addEventListener("DOMContentLoaded", ()=>{
    const savedTheme = localStorage.getItem("theme");

    if(savedTheme === "day"){
        setDay();
    } else {
        setNight();
    }
    updateButton();
});
</script>
<!-- BOOTSTRAP -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
